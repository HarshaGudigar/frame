services:
    app:
        build: .
        image: frame-app:latest
        container_name: frame-app
        ports:
            - '3000:3000'
            - '5000:5000'
        volumes:
            - mongodb_data:/data/db
            - backup_data:/backups
        healthcheck:
            test:
                [
                    'CMD',
                    'node',
                    '-e',
                    "const http=require('http');const r=http.get('http://localhost:5000/api/health',res=>{process.exit(res.statusCode===200?0:1)});r.on('error',()=>process.exit(1));r.end()",
                ]
            interval: 30s
            timeout: 5s
            start_period: 30s
            retries: 3
        restart: always

volumes:
    mongodb_data:
    backup_data:
