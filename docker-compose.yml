services:
    mongo:
        image: mongo:6.0
        container_name: frame-mongo
        volumes:
            - mongodb_data:/data/db
        healthcheck:
            test:
                [
                    'CMD',
                    'mongosh',
                    '--quiet',
                    '127.0.0.1:27017/mern-app',
                    '--eval',
                    'db.adminCommand("ping")',
                ]
            interval: 10s
            timeout: 5s
            start_period: 20s
            retries: 5
        restart: always

    backend:
        build:
            context: .
            dockerfile: Dockerfile.backend
        container_name: frame-backend
        depends_on:
            mongo:
                condition: service_healthy
        env_file:
            - backend/.env
        environment:
            - MONGODB_URI=mongodb://mongo:27017/mern-app
        volumes:
            - backup_data:/backups
        ports:
            - '5000:5000'
        restart: always

    frontend:
        build:
            context: .
            dockerfile: Dockerfile.frontend
        container_name: frame-frontend
        depends_on:
            backend:
                condition: service_healthy
        ports:
            - '3000:3000'
        restart: always

volumes:
    mongodb_data:
    backup_data:
